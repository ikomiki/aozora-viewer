var oe=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var U=(a,e,n)=>e in a?oe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,_=(a,e)=>{for(var n in e||(e={}))de.call(e,n)&&U(a,n,e[n]);if(K)for(var n of K(e))ue.call(e,n)&&U(a,n,e[n]);return a},b=(a,e)=>le(a,ce(e));import{r as u,a as he,R as q}from"./vendor-snxfSDpH.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();var Q={exports:{}},z={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge=u,pe=Symbol.for("react.element"),me=Symbol.for("react.fragment"),fe=Object.prototype.hasOwnProperty,_e=ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xe={key:!0,ref:!0,__self:!0,__source:!0};function ee(a,e,n){var s,t={},r=null,i=null;n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(i=e.ref);for(s in e)fe.call(e,s)&&!xe.hasOwnProperty(s)&&(t[s]=e[s]);if(a&&a.defaultProps)for(s in e=a.defaultProps,e)t[s]===void 0&&(t[s]=e[s]);return{$$typeof:pe,type:a,key:r,ref:i,props:t,_owner:_e.current}}z.Fragment=me;z.jsx=ee;z.jsxs=ee;Q.exports=z;var o=Q.exports,G={},V=he;G.createRoot=V.createRoot,G.hydrateRoot=V.hydrateRoot;const be=({initialWidth:a,minWidth:e,maxWidth:n,onWidthChange:s})=>{const[t,r]=u.useState(a),[i,l]=u.useState(!1),c=u.useRef(0),d=u.useRef(0),h=u.useCallback(x=>{if(!i)return;const f=x.clientX-c.current,y=Math.max(e,Math.min(n,d.current+f));r(y),s(y)},[i,e,n,s]),m=u.useCallback(()=>{l(!1)},[]);u.useEffect(()=>{if(i)return document.addEventListener("mousemove",h),document.addEventListener("mouseup",m),()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",m)}},[i,h,m]);const S=u.useCallback(x=>{x.preventDefault(),l(!0),c.current=x.clientX,d.current=t},[t]);return{width:t,isResizing:i,resizerProps:{onMouseDown:S}}},p={DEFAULT_WIDTH:280,COLLAPSED_WIDTH:40,MIN_WIDTH:200,MAX_WIDTH:600,STORAGE_KEYS:{LEFT_OPEN:"aozora-sidebar-left",RIGHT_OPEN:"aozora-sidebar-right",LEFT_WIDTH:"aozora-sidebar-left-width",RIGHT_WIDTH:"aozora-sidebar-right-width"},ARIA_LABELS:{LEFT:"Table of contents",RIGHT:"Settings panel"}},Se="_sidebar_hhhpp_2",w={sidebar:Se,"sidebar-left":"_sidebar-left_hhhpp_15","sidebar-right":"_sidebar-right_hhhpp_20","sidebar-closed":"_sidebar-closed_hhhpp_26","sidebar-content":"_sidebar-content_hhhpp_26","sidebar-open":"_sidebar-open_hhhpp_32","sidebar-toggle":"_sidebar-toggle_hhhpp_38","resize-handle":"_resize-handle_hhhpp_75"},Y=({side:a,isOpen:e,onToggle:n,children:s,ariaLabel:t,width:r=p.DEFAULT_WIDTH,onWidthChange:i,canResize:l=!1})=>{const c=be({initialWidth:r,minWidth:p.MIN_WIDTH,maxWidth:p.MAX_WIDTH,onWidthChange:i||(()=>{})}),d="".concat(w.sidebar," ").concat(w["sidebar-".concat(a)]," ").concat(e?w["sidebar-open"]:w["sidebar-closed"]),h=a==="left"?p.ARIA_LABELS.LEFT:p.ARIA_LABELS.RIGHT,m=e?r:p.COLLAPSED_WIDTH,S={width:"".concat(m,"px")};return o.jsxs("aside",{className:d,style:S,role:"complementary","aria-label":t||h,"aria-expanded":e,children:[o.jsx("button",{className:w["sidebar-toggle"],onClick:n,onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),n())},"aria-label":"".concat(e?"Close":"Open"," ").concat(a," sidebar"),type:"button",children:a==="left"?e?"←":"→":e?"→":"←"}),l&&o.jsx("div",_({className:w["resize-handle"],"data-testid":"resize-handle"},c.resizerProps)),o.jsx("div",{className:w["sidebar-content"],"aria-hidden":!e,children:s})]})},k={fontSize:16,lineHeight:1.6,horizontalMargin:20,letterSpacing:0,paragraphSpacing:16},te={fontSize:{min:12,max:36},lineHeight:{min:1.2,max:2.5},horizontalMargin:{min:0,max:200},letterSpacing:{min:-.5,max:2},paragraphSpacing:{min:0,max:50}},B={fontSize:"aozora-settings-fontSize",lineHeight:"aozora-settings-lineHeight",horizontalMargin:"aozora-settings-horizontalMargin",letterSpacing:"aozora-settings-letterSpacing",paragraphSpacing:"aozora-settings-paragraphSpacing"},ne=(a,e,n)=>Math.max(e,Math.min(n,a)),ye=()=>{const a=_({},k);return Object.entries(B).forEach(([e,n])=>{try{const s=localStorage.getItem(n);if(s!==null){const t=parseFloat(s);if(!isNaN(t)){const r=te[e];a[e]=ne(t,r.min,r.max)}}}catch(s){console.warn("Failed to load setting ".concat(e,":"),s)}}),a},O=a=>{const e=document.documentElement;e.style.setProperty("--document-font-size","".concat(a.fontSize,"px")),e.style.setProperty("--document-line-height","".concat(a.lineHeight)),e.style.setProperty("--document-horizontal-margin","".concat(a.horizontalMargin,"px")),e.style.setProperty("--document-letter-spacing","".concat(a.letterSpacing,"px")),e.style.setProperty("--document-paragraph-spacing","".concat(a.paragraphSpacing,"px"))},ve=()=>{const a={};return{save:(s,t)=>{const r=B[s];a[s]&&clearTimeout(a[s]),a[s]=window.setTimeout(()=>{try{localStorage.setItem(r,String(t))}catch(i){console.warn("Failed to save setting ".concat(s,":"),i)}delete a[s]},500)},cleanup:()=>{Object.values(a).forEach(clearTimeout),Object.keys(a).forEach(s=>delete a[s])}}},re=ve(),Te=re.save,je=()=>{const[a,e]=u.useState(()=>ye());u.useEffect(()=>(O(a),()=>{re.cleanup()}),[]);const n=u.useCallback((r,i)=>{const l=te[r],c=ne(i,l.min,l.max);e(d=>{const h=b(_({},d),{[r]:c});return O(h),h}),Te(r,c)},[]),s=u.useCallback(r=>{const i=k[r];e(l=>{const c=b(_({},l),{[r]:i});return O(c),c});try{localStorage.removeItem(B[r])}catch(l){console.warn("Failed to remove setting ".concat(r,":"),l)}},[]),t=u.useCallback(()=>{e(k),O(k),Object.values(B).forEach(r=>{try{localStorage.removeItem(r)}catch(i){console.warn("Failed to remove setting ".concat(r,":"),i)}})},[]);return{settings:a,updateSetting:n,resetSetting:s,resetToDefaults:t}},Ce="_container_180b3_1",Ie="_header_180b3_5",Ee="_label_180b3_12",Re="_value_180b3_18",De="_controls_180b3_26",we="_slider_180b3_32",Me="_resetButton_180b3_96",M={container:Ce,header:Ie,label:Ee,value:Re,controls:De,slider:we,resetButton:Me},A=({label:a,value:e,min:n,max:s,step:t,unit:r,onChange:i,onReset:l})=>{const c=u.useCallback(f=>{const y=parseFloat(f.target.value);i(y)},[i]),d=u.useCallback(f=>{switch(f.key){case"ArrowRight":case"ArrowUp":f.preventDefault(),i(Math.min(s,e+t));break;case"ArrowLeft":case"ArrowDown":f.preventDefault(),i(Math.max(n,e-t));break;case"Home":f.preventDefault(),i(n);break;case"End":f.preventDefault(),i(s);break}},[e,n,s,t,i]),h=r?"".concat(e).concat(r):String(e),m="setting-slider-".concat(a.replace(/\s+/g,"-").toLowerCase()),S="".concat(m,"-label"),x="".concat(m,"-value");return o.jsxs("div",{className:M.container,children:[o.jsxs("div",{className:M.header,children:[o.jsx("label",{id:S,htmlFor:m,className:M.label,children:a}),o.jsx("span",{id:x,className:M.value,children:h})]}),o.jsxs("div",{className:M.controls,children:[o.jsx("input",{id:m,type:"range",className:M.slider,value:e,min:n,max:s,step:t,onChange:c,onKeyDown:d,"aria-label":a,"aria-valuemin":n,"aria-valuemax":s,"aria-valuenow":e,"aria-valuetext":h,"aria-describedby":"".concat(S," ").concat(x)}),o.jsx("button",{type:"button",className:M.resetButton,onClick:l,"aria-label":"Reset ".concat(a),title:"Reset ".concat(a," to default"),children:"↺"})]})]})},Ne="_container_u0aau_1",Le="_header_u0aau_8",Ae="_title_u0aau_17",Pe="_resetAllButton_u0aau_24",Oe="_settings_u0aau_50",P={container:Ne,header:Le,title:Ae,resetAllButton:Pe,settings:Oe},Fe=()=>{const{settings:a,updateSetting:e,resetSetting:n,resetToDefaults:s}=je(),t=u.useCallback(f=>{e("fontSize",f)},[e]),r=u.useCallback(f=>{e("lineHeight",f)},[e]),i=u.useCallback(f=>{e("horizontalMargin",f)},[e]),l=u.useCallback(f=>{e("letterSpacing",f)},[e]),c=u.useCallback(f=>{e("paragraphSpacing",f)},[e]),d=u.useCallback(()=>{n("fontSize")},[n]),h=u.useCallback(()=>{n("lineHeight")},[n]),m=u.useCallback(()=>{n("horizontalMargin")},[n]),S=u.useCallback(()=>{n("letterSpacing")},[n]),x=u.useCallback(()=>{n("paragraphSpacing")},[n]);return o.jsxs("div",{className:P.container,role:"region","aria-label":"表示設定",children:[o.jsxs("div",{className:P.header,children:[o.jsx("h3",{className:P.title,children:"表示設定"}),o.jsx("button",{type:"button",className:P.resetAllButton,onClick:s,"aria-label":"すべてリセット",title:"すべての設定をデフォルト値に戻す",children:"すべてリセット"})]}),o.jsxs("div",{className:P.settings,children:[o.jsx(A,{label:"文字サイズ",value:a.fontSize,min:12,max:36,step:1,unit:"px",onChange:t,onReset:d}),o.jsx(A,{label:"行間",value:a.lineHeight,min:1.2,max:2.5,step:.1,unit:"",onChange:r,onReset:h}),o.jsx(A,{label:"左右マージン",value:a.horizontalMargin,min:0,max:200,step:5,unit:"px",onChange:i,onReset:m}),o.jsx(A,{label:"文字間隔",value:a.letterSpacing,min:-.5,max:2,step:.1,unit:"px",onChange:l,onReset:S}),o.jsx(A,{label:"段落間隔",value:a.paragraphSpacing,min:0,max:50,step:2,unit:"px",onChange:c,onReset:x})]})]})},X={left:{isOpen:!1,width:p.DEFAULT_WIDTH},right:{isOpen:!1,width:p.DEFAULT_WIDTH}},ke=()=>{const[a,e]=u.useState(()=>{try{const r=localStorage.getItem(p.STORAGE_KEYS.LEFT_OPEN),i=localStorage.getItem(p.STORAGE_KEYS.RIGHT_OPEN),l=localStorage.getItem(p.STORAGE_KEYS.LEFT_WIDTH),c=localStorage.getItem(p.STORAGE_KEYS.RIGHT_WIDTH);return{left:{isOpen:r==="true",width:l?Math.max(p.MIN_WIDTH,Math.min(p.MAX_WIDTH,parseInt(l))):p.DEFAULT_WIDTH},right:{isOpen:i==="true",width:c?Math.max(p.MIN_WIDTH,Math.min(p.MAX_WIDTH,parseInt(c))):p.DEFAULT_WIDTH}}}catch(r){return X}}),n=u.useCallback(r=>{e(i=>{const l=b(_({},i),{[r]:b(_({},i[r]),{isOpen:!i[r].isOpen})}),c=r==="left"?p.STORAGE_KEYS.LEFT_OPEN:p.STORAGE_KEYS.RIGHT_OPEN;return localStorage.setItem(c,String(l[r].isOpen)),l})},[]),s=u.useCallback((r,i)=>{const l=Math.max(p.MIN_WIDTH,Math.min(p.MAX_WIDTH,i));e(c=>{const d=b(_({},c),{[r]:b(_({},c[r]),{width:l})}),h=r==="left"?p.STORAGE_KEYS.LEFT_WIDTH:p.STORAGE_KEYS.RIGHT_WIDTH;return localStorage.setItem(h,String(l)),d})},[]),t=u.useCallback(()=>{e(X),localStorage.removeItem(p.STORAGE_KEYS.LEFT_OPEN),localStorage.removeItem(p.STORAGE_KEYS.RIGHT_OPEN),localStorage.removeItem(p.STORAGE_KEYS.LEFT_WIDTH),localStorage.removeItem(p.STORAGE_KEYS.RIGHT_WIDTH)},[]);return{sidebarState:a,toggleSidebar:n,setSidebarWidth:s,resetToDefaults:t}},Be="_layout_12oyo_2",F={layout:Be,"main-content":"_main-content_12oyo_11","main-placeholder":"_main-placeholder_12oyo_21","sidebar-placeholder":"_sidebar-placeholder_12oyo_40"},ze=({children:a})=>{const{sidebarState:e,toggleSidebar:n,setSidebarWidth:s}=ke(),[t,r]=u.useState(!0);u.useEffect(()=>{const d=()=>{r(window.innerWidth>768)};return d(),window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}},[]);const i=t?e.left.isOpen?e.left.width:p.COLLAPSED_WIDTH:0,l=t?e.right.isOpen?e.right.width:p.COLLAPSED_WIDTH:0,c={marginLeft:"".concat(i,"px"),marginRight:"".concat(l,"px")};return o.jsxs("div",{className:F.layout,children:[o.jsx(Y,{side:"left",isOpen:e.left.isOpen,onToggle:()=>n("left"),width:e.left.width,onWidthChange:d=>s("left",d),canResize:!0,ariaLabel:"Table of contents",children:o.jsxs("div",{className:F["sidebar-placeholder"],children:[o.jsx("h3",{children:"目次"}),o.jsx("p",{children:"ここに目次が表示されます"})]})}),o.jsx("main",{className:F["main-content"],style:c,role:"main","aria-label":"Main content",children:a||o.jsxs("div",{className:F["main-placeholder"],children:[o.jsx("h1",{children:"青空文庫ビューワ"}),o.jsx("p",{children:"ここにドキュメントが表示されます"})]})}),o.jsx(Y,{side:"right",isOpen:e.right.isOpen,onToggle:()=>n("right"),width:e.right.width,onWidthChange:d=>s("right",d),canResize:!0,ariaLabel:"Settings panel",children:o.jsx(Fe,{})})]})},He="_dropZone_11s3x_1",$e="_dragOver_11s3x_28",We="_disabled_11s3x_34",Ge="_message_11s3x_40",Ke="_subMessage_11s3x_46",Ue="_fileButton_11s3x_52",Ve="_hiddenInput_11s3x_72",Ye="_loadingOverlay_11s3x_80",Xe="_loadingMessage_11s3x_94",Je="_progressBar_11s3x_100",Ze="_progressFill_11s3x_108",T={dropZone:He,dragOver:$e,disabled:We,message:Ge,subMessage:Ke,fileButton:Ue,hiddenInput:Ve,loadingOverlay:Ye,loadingMessage:Xe,progressBar:Je,progressFill:Ze};class J{static async detectAndDecode(e){const n=await e.arrayBuffer(),s=new Uint8Array(n),t=this.hasUtf8Bom(s),r=this.tryDecodeAsUtf8(s,t);if(r.isValid&&r.confidence>=.8)return r;const i=this.tryDecodeAsShiftJis(s);return i.isValid?i:b(_({},r),{confidence:.1,isValid:!1})}static hasUtf8Bom(e){return e.length>=3&&e[0]===239&&e[1]===187&&e[2]===191}static tryDecodeAsUtf8(e,n){try{const s=n?e.slice(3):e,r=new TextDecoder("utf-8",{fatal:!0}).decode(s),i=this.calculateUtf8Confidence(r,e);return{encoding:"utf-8",confidence:i,text:r,isValid:i>=.7,hasBom:n}}catch(s){return{encoding:"utf-8",confidence:0,text:"",isValid:!1,hasBom:n}}}static tryDecodeAsShiftJis(e){try{const s=new TextDecoder("shift-jis",{fatal:!1}).decode(e),t=this.calculateShiftJisConfidence(s,e);return{encoding:"shift-jis",confidence:t,text:s,isValid:t>=.6,hasBom:!1}}catch(n){return{encoding:"shift-jis",confidence:0,text:"",isValid:!1,hasBom:!1}}}static calculateUtf8Confidence(e,n){if(e.length===0)return .8;let s=.5;const t=e.replace(/[^\u0000-\u007F]/g,"");t.length===e.length&&(s=.8);const r=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,i=e.match(r);i&&i.length>0&&(s+=.3);const l=/[\uFFFD]/g,c=e.match(l);return c&&c.length>0&&(s-=.4),(e.length-t.length)/e.length>.1&&(s+=.2),Math.max(0,Math.min(1,s))}static calculateShiftJisConfidence(e,n){let s=.4;const t=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,r=e.match(t);r&&r.length>0&&(s+=.4);const i=/[\uFFFD]/g,l=e.match(i);return l&&l.length>0&&(s-=.3),s+=this.checkShiftJisBytePatterns(n),Math.max(0,Math.min(1,s))}static checkShiftJisBytePatterns(e){let n=0;const s=e.length;for(let t=0;t<s;t++){const r=e[t];if((r>=129&&r<=159||r>=224&&r<=252)&&t+1<s){const i=e[t+1];(i>=64&&i<=126||i>=128&&i<=252)&&(n+=.01,t++)}}return Math.min(.3,n)}static isBinaryFile(e){const n=Math.min(8e3,e.length);let s=0;for(let t=0;t<n;t++)e[t]===0&&s++;return s/n>.01}}const qe=({onFileLoad:a,onError:e,maxFileSize:n=10*1024*1024,acceptedFileTypes:s=["text/plain","text/html"],disabled:t=!1,className:r=""})=>{const[i,l]=u.useState({isDragOver:!1,isLoading:!1,loadingProgress:0}),c=u.useRef(null),d=u.useCallback(g=>g.size>n?"ファイルサイズが大きすぎます。10MB以下のファイルを選択してください。":!s.includes(g.type)&&!g.name.endsWith(".txt")?"対応していないファイル形式です。テキストファイルを選択してください。":null,[n,s]),h=u.useCallback(async g=>{const j=d(g);if(j){e(j);return}l(R=>b(_({},R),{isLoading:!0,loadingProgress:0}));try{const R=await g.arrayBuffer(),H=new Uint8Array(R);if(J.isBinaryFile(H)){l(I=>b(_({},I),{isLoading:!1,loadingProgress:0})),e("バイナリファイルは読み込めません。テキストファイルを選択してください。");return}l(I=>b(_({},I),{loadingProgress:50}));const D=await J.detectAndDecode(g);if(l(I=>b(_({},I),{loadingProgress:90})),!D.isValid){const I="文字エンコードの検出に失敗しました。".concat(D.encoding,"として読み込みましたが、文字化けしている可能性があります。");console.warn(I)}l(I=>b(_({},I),{isLoading:!1,loadingProgress:100})),a(D.text,g.name,{encoding:D.encoding,confidence:D.confidence,hasBom:D.hasBom,isValidEncoding:D.isValid})}catch(R){l(H=>b(_({},H),{isLoading:!1,loadingProgress:0})),e("ファイルの読み込みに失敗しました。"),console.error("File processing error:",R)}},[d,a,e]),m=u.useCallback(g=>{if(!g||g.length===0)return;const j=g[0];h(j)},[h]),S=u.useCallback(g=>{g.preventDefault(),g.stopPropagation(),t||l(j=>b(_({},j),{isDragOver:!0}))},[t]),x=u.useCallback(g=>{g.preventDefault(),g.stopPropagation(),l(j=>b(_({},j),{isDragOver:!1}))},[]),f=u.useCallback(g=>{g.preventDefault(),g.stopPropagation()},[]),y=u.useCallback(g=>{if(g.preventDefault(),g.stopPropagation(),l(R=>b(_({},R),{isDragOver:!1})),t||i.isLoading)return;const j=g.dataTransfer.files;m(j)},[t,i.isLoading,m]),C=u.useCallback(()=>{!t&&!i.isLoading&&c.current&&c.current.click()},[t,i.isLoading]),N=u.useCallback(g=>{g.stopPropagation(),C()},[C]),L=u.useCallback(g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),C())},[C]),ae=u.useCallback(g=>{m(g.target.files)},[m]),ie=[T.dropZone,i.isDragOver?T.dragOver:"",t?T.disabled:"",r].filter(Boolean).join(" ");return o.jsxs("div",{className:ie,onDragEnter:S,onDragLeave:x,onDragOver:f,onDrop:y,onClick:C,onKeyDown:L,role:"button",tabIndex:t?-1:0,"aria-label":"ファイルドロップエリア","aria-disabled":t,children:[o.jsx("div",{className:T.message,children:"📄 ファイルをドロップするか、ボタンをクリック"}),o.jsx("div",{className:T.subMessage,children:"対応形式: .txt (10MB以下)"}),o.jsx("button",{type:"button",className:T.fileButton,onClick:N,disabled:t||i.isLoading,children:"📁 ファイルを選択"}),o.jsx("input",{ref:c,type:"file",className:T.hiddenInput,accept:".txt,text/plain",onChange:ae,disabled:t||i.isLoading,"aria-label":"ファイル選択"}),i.isLoading&&o.jsxs("div",{className:T.loadingOverlay,children:[o.jsx("div",{className:T.loadingMessage,children:"📖 読み込み中..."}),o.jsx("div",{className:T.progressBar,role:"progressbar","aria-valuenow":i.loadingProgress,"aria-valuemin":0,"aria-valuemax":100,children:o.jsx("div",{className:T.progressFill,style:{width:"".concat(i.loadingProgress,"%")}})})]})]})},Qe="_ruby_15mw7_1",et={ruby:Qe},tt=({element:a,className:e=""})=>{const n=[et.ruby,e].filter(Boolean).join(" ");return o.jsxs("ruby",{className:n,role:"ruby","data-ruby":a.ruby,children:[o.jsx("span",{children:a.text}),o.jsx("rt",{children:a.ruby})]})},nt="_heading_165gp_1",rt="_large_165gp_10",st="_medium_165gp_17",at="_small_165gp_24",it="_clickable_165gp_30",$={heading:nt,large:rt,medium:st,small:at,clickable:it},ot=({element:a,onClick:e,className:n=""})=>{const s=u.useCallback(()=>{e&&e(a)},[e,a]),t=u.useCallback(l=>{(l.key==="Enter"||l.key===" ")&&e&&(l.preventDefault(),e(a))},[e,a]),r=[$.heading,$[a.level],e?$.clickable:"",n].filter(Boolean).join(" "),i={id:a.id,className:r,"aria-label":a.text,onClick:e?s:void 0,onKeyDown:e?t:void 0,tabIndex:e?0:void 0,style:e?{cursor:"pointer"}:void 0};switch(a.level){case"large":return o.jsx("h1",b(_({},i),{children:a.text}));case"medium":return o.jsx("h2",b(_({},i),{children:a.text}));case"small":return o.jsx("h3",b(_({},i),{children:a.text}));default:return o.jsx("h3",b(_({},i),{children:a.text}))}},lt="_imageContainer_imxhi_1",ct="_image_imxhi_1",dt="_responsive_imxhi_16",ut="_loading_imxhi_21",ht="_error_imxhi_32",gt="_errorIcon_imxhi_46",pt="_errorMessage_imxhi_52",mt="_errorDetail_imxhi_57",ft="_loaded_imxhi_77",v={imageContainer:lt,image:ct,responsive:dt,loading:ut,error:ht,errorIcon:gt,errorMessage:pt,errorDetail:mt,loaded:ft},_t=({element:a,onLoad:e,onError:n,className:s="",lazy:t=!1})=>{const[r,i]=u.useState("loading"),[,l]=u.useState(""),c=u.useCallback(()=>{i("loaded");const x=a.base64||a.filename||"";e&&e(x,a)},[a,e]),d=u.useCallback(x=>{i("error");const f=a.base64||a.filename||"",y=new Error("Failed to load image: ".concat(f));l(y.message),n&&n(f,a,y)},[a,n]),h=[v.imageContainer,s].filter(Boolean).join(" "),m=[v.image,v.responsive,r==="loaded"?v.loaded:""].filter(Boolean).join(" "),S=a.base64||a.filename||"";return S?r==="error"?o.jsx("figure",{className:h,children:o.jsxs("div",{className:v.error,children:[o.jsx("span",{className:v.errorIcon,children:"❌"}),o.jsx("div",{className:v.errorMessage,children:"画像を読み込めませんでした"}),o.jsx("div",{className:v.errorDetail,children:a.description})]})}):o.jsxs("figure",{className:h,children:[o.jsx("img",{src:S,alt:a.description||"",className:m,width:a.width,height:a.height,loading:t?"lazy":void 0,onLoad:c,onError:d}),r==="loading"&&o.jsx("div",{className:v.loading,children:"📸 読み込み中..."})]}):o.jsx("figure",{className:h,children:o.jsxs("div",{className:v.error,children:[o.jsx("span",{className:v.errorIcon,children:"🖼️"}),o.jsx("div",{className:v.errorMessage,children:"画像ソースが見つかりません"}),o.jsx("div",{className:v.errorDetail,children:a.description})]})})},xt=({element:a,className:e=""})=>{const n=["caption",e].filter(Boolean).join(" ");return o.jsx("figcaption",{className:n,children:a.text})},bt=({element:a,className:e=""})=>{const n=a.content.split("\n").map((s,t,r)=>o.jsxs(q.Fragment,{children:[s,t<r.length-1&&o.jsx("br",{})]},t));return o.jsx("span",{className:e,style:{whiteSpace:"pre-wrap"},children:n})},Z={"indented-text":"_indented-text_1o28i_1","negative-indent":"_negative-indent_1o28i_6"};function St({element:a}){const{content:e,indentCount:n}=a,s=l=>l>0?"　".repeat(l):"",t=[Z["indented-text"]],r={};n<0&&(t.push(Z["negative-indent"]),r.marginLeft="".concat(n,"em"));const i=n>0?s(n)+e:e;return o.jsx("span",{className:t.join(" "),style:r,children:i})}const yt={"left-indented-text":"_left-indented-text_gmgrg_1"};function vt({element:a}){const{content:e,indentCount:n}=a,t=(r=>Math.max(r,0)>0?"　".repeat(Math.max(r,0)):"")(n)+e;return o.jsx("span",{className:yt["left-indented-text"],children:t})}const Tt={"right-indented-text":"_right-indented-text_ypq3a_1"};function jt({element:a}){const{content:e,indentCount:n}=a,s=Math.max(n,0);return o.jsx("span",{className:Tt["right-indented-text"],style:{marginRight:"".concat(s,"em"),display:"block",textAlign:"right"},children:e})}const Ct={"indent-block":"_indent-block_8bpis_1"};function It({element:a}){const{elements:e,indentCount:n}=a,s=Math.max(0,n),t={marginLeft:"".concat(s,"em")};return o.jsx("div",{className:Ct["indent-block"],style:t,children:e.map((r,i)=>o.jsx(se,{element:r},i))})}const se=({element:a,onImageLoad:e,onImageError:n,onHeadingClick:s,className:t=""})=>{switch(a.type){case"ruby":return o.jsx(tt,{element:a,className:t});case"heading":return o.jsx(ot,{element:a,onClick:s,className:t});case"image":return o.jsx(_t,{element:a,onLoad:e,onError:n,className:t,lazy:!0});case"caption":return o.jsx(xt,{element:a,className:t});case"text":return o.jsx(bt,{element:a,className:t});case"indented-text":return o.jsx(St,{element:a});case"left-indented-text":return o.jsx(vt,{element:a});case"right-indented-text":return o.jsx(jt,{element:a});case"indent-block":return o.jsx(It,{element:a});default:return console.warn("Unknown element type:",a.type),o.jsx("span",{className:t,children:JSON.stringify(a)})}},Et="_documentRenderer_vxyd1_1",Rt="_emptyState_vxyd1_12",Dt="_emptyIcon_vxyd1_23",wt="_virtualScroll_vxyd1_28",Mt="_blockWrapper_vxyd1_43",Nt="_inlineWrapper_vxyd1_49",E={documentRenderer:Et,emptyState:Rt,emptyIcon:Dt,virtualScroll:wt,blockWrapper:Mt,inlineWrapper:Nt},Lt=({document:a,className:e="",onImageLoad:n,onImageError:s,onHeadingClick:t})=>{const r=u.useMemo(()=>a&&a.elements.length>100,[a]),i=[E.documentRenderer,r?E.virtualScroll:"",e].filter(Boolean).join(" ");return a?a.elements.length===0?o.jsx("article",{className:i,role:"document","aria-label":"文書コンテンツ",children:o.jsxs("div",{className:E.emptyState,children:[o.jsx("div",{className:E.emptyIcon,children:"📝"}),o.jsx("div",{children:"文書に内容がありません"}),o.jsx("div",{children:"ファイルが空か、解析できませんでした"})]})}):o.jsx("article",{className:i,role:"document","aria-label":"文書コンテンツ",tabIndex:0,children:a.elements.map((l,c)=>{const d=l.type==="heading"||l.type==="image"||l.type==="caption",h=d?"div":"span",m=d?E.blockWrapper:E.inlineWrapper;return o.jsx(h,{className:m,children:o.jsx(se,{element:l,onImageLoad:n,onImageError:s,onHeadingClick:t})},"".concat(l.type,"-").concat(c))})}):o.jsx("article",{className:i,role:"document","aria-label":"文書コンテンツ",children:o.jsxs("div",{className:E.emptyState,children:[o.jsx("div",{className:E.emptyIcon,children:"📄"}),o.jsx("div",{children:"文書が選択されていません"}),o.jsx("div",{children:"ファイルをドロップするか選択してください"})]})})};var At=Object.defineProperty,Pt=(a,e,n)=>e in a?At(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,Ot=(a,e,n)=>Pt(a,e+"",n);class Ft{constructor(e=20){Ot(this,"maxIndentCount"),this.maxIndentCount=e}parseLeftIndent(e,n){const s=/^［＃([０-９0-9]+)字上げ］/,t=e.match(s);if(!t)return null;const r=t[1].replace(/[０-９]/g,d=>String.fromCharCode(d.charCodeAt(0)-65248)),i=parseInt(r,10);if(i<=0)return null;const l=t[0],c=this.createRange(n,n+l.length);return{element:{type:"formatting-instruction",instruction:l,instructionType:"left-indent",indentCount:i,range:c},length:l.length}}parseRightIndent(e,n){const s=/^［＃地から([０-９0-9]+)字上げ］/,t=e.match(s);if(!t)return null;const r=t[1].replace(/[０-９]/g,d=>String.fromCharCode(d.charCodeAt(0)-65248)),i=parseInt(r,10);if(i<=0)return null;const l=t[0],c=this.createRange(n,n+l.length);return{element:{type:"formatting-instruction",instruction:l,instructionType:"right-indent",indentCount:i,range:c},length:l.length}}parseBlockIndentStart(e,n){const s=/^［＃ここから([０-９0-9]+)字下げ］/,t=e.match(s);if(!t)return null;const r=t[1].replace(/[０-９]/g,h=>String.fromCharCode(h.charCodeAt(0)-65248)),i=parseInt(r,10);if(i<=0)return null;const l=Math.min(i,this.maxIndentCount),c=t[0],d=this.createRange(n,n+c.length);return{element:{type:"formatting-instruction",instruction:c,instructionType:"indent-start",indentCount:l,range:d},length:c.length}}parseBlockIndentEnd(e,n){const s=/^［＃ここで字下げ終わり］/,t=e.match(s);if(!t)return null;const r=t[0],i=this.createRange(n,n+r.length);return{element:{type:"formatting-instruction",instruction:r,instructionType:"indent-end",indentCount:void 0,range:i},length:r.length}}preserveLeadingSpaces(e){return e.replace(/^[ \t]+/,"")}createRange(e,n){return{start:{line:0,column:e,index:e},end:{line:0,column:n,index:n}}}}class kt{processIndentBlocks(e){const n=[],s=[];for(const t of e)if(t.type==="formatting-instruction")if(t.instructionType==="indent-start"){const r={indentCount:t.indentCount||1,elements:[],startRange:t.range};s.push(r)}else if(t.instructionType==="indent-end"){if(s.length>0){const r=s.pop(),i={type:"indent-block",indentCount:r.indentCount,elements:r.elements,range:{start:r.startRange.start,end:t.range.end}};s.length>0?s[s.length-1].elements.push(i):n.push(i)}}else(t.instructionType==="left-indent"||t.instructionType==="right-indent")&&(s.length>0?s[s.length-1].elements.push(t):n.push(t));else s.length>0?s[s.length-1].elements.push(t):n.push(t);for(;s.length>0;){const t=s.pop(),r={type:"indent-block",indentCount:t.indentCount,elements:t.elements,range:t.startRange};s.length>0?s[s.length-1].elements.push(r):n.push(r)}return n}removeFormattingInstructions(e){return e.filter(n=>n.type!=="formatting-instruction")}}var Bt=Object.defineProperty,zt=(a,e,n)=>e in a?Bt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,W=(a,e,n)=>zt(a,typeof e!="symbol"?e+"":e,n);class Ht{constructor(e){W(this,"config"),W(this,"formattingParser"),W(this,"blockProcessor"),this.config=_({enableRuby:!0,enableHeadings:!0,enableImages:!0,enableCaptions:!0,enableEmphasis:!0,enableTextFormatting:!0,preserveLeadingSpaces:!0,maxIndentCount:20,strictMode:!1,maxFileSize:10*1024*1024},e),this.formattingParser=new Ft(this.config.maxIndentCount),this.blockProcessor=new kt}parse(e,n,s){const t=performance.now();if(e.length>this.config.maxFileSize)throw new Error("File size exceeds maximum limit of ".concat(this.config.maxFileSize," bytes"));const r=[],i=[],l=[];if(e.length===0)return this.createDocument(r,i,l,n,t,e,s);try{const c=this.parseText(e);for(const d of c)r.push(d),d.type==="heading"?i.push(d):d.type==="image"&&l.push(d);return this.createDocument(r,i,l,n,t,e,s)}catch(c){return console.warn("Parser error, attempting partial parse:",c),this.createDocument(r,i,l,n,t,e,s)}}parseText(e){const n=[],s=e.split(/\r?\n/);let t=0;for(const i of s){const l=this.config.preserveLeadingSpaces?this.formattingParser.preserveLeadingSpaces(i):i.trim();if(l.length===0){n.push({type:"text",content:"\n",range:this.createRange(t,t+1)}),t+=i.length+1;continue}let c=0;for(;c<l.length;){const d=l.slice(c);let h=!1;if(this.config.enableTextFormatting){const y=this.formattingParser.parseLeftIndent(d,t+c);if(y){n.push(y.element),c+=y.length,h=!0;continue}const C=this.formattingParser.parseRightIndent(d,t+c);if(C){n.push(C.element),c+=C.length,h=!0;continue}const N=this.formattingParser.parseBlockIndentStart(d,t+c);if(N){n.push(N.element),c+=N.length,h=!0;continue}const L=this.formattingParser.parseBlockIndentEnd(d,t+c);if(L){n.push(L.element),c+=L.length,h=!0;continue}}const m=this.parseRuby(d,t+c);if(m){n.push(m.element),c+=m.length,h=!0;continue}const S=this.parseHeading(d,t+c);if(S){n.push(S.element),c+=S.length,h=!0;continue}const x=this.parseImage(d,t+c);if(x){n.push(x.element),c+=x.length,h=!0;continue}const f=this.parseCaption(d,t+c);if(f){n.push(f.element),c+=f.length,h=!0;continue}if(!h){const y=this.parsePlainText(d,t+c);y?(n.push(y.element),c+=y.length):c++}}n.push({type:"text",content:"\n",range:this.createRange(t+i.length,t+i.length+1)}),t+=i.length+1}let r=n;return this.config.enableTextFormatting&&(r=this.blockProcessor.processIndentBlocks(n),r=this.processIndentInstructions(r)),this.cleanupElements(r)}processIndentInstructions(e){const n=[];for(let s=0;s<e.length;s++){const t=e[s];if(t.type==="formatting-instruction"&&(t.instructionType==="left-indent"||t.instructionType==="right-indent")){const r=e[s+1];if(r&&r.type==="text"){if(t.instructionType==="left-indent"){const i={type:"left-indented-text",content:r.content,indentCount:t.indentCount||0,range:{start:t.range.start,end:r.range.end}};n.push(i)}else{const i={type:"right-indented-text",content:r.content,indentCount:t.indentCount||0,range:{start:t.range.start,end:r.range.end}};n.push(i)}s++}}else n.push(t)}return n}parseRuby(e,n){if(!this.config.enableRuby)return null;const s=/^｜([^《]+)《([^》]+)》/,t=/^([^｜［《\s]+)《([^》]+)》/,r=e.match(s);if(r){const[l,c,d]=r;return{element:{type:"ruby",text:c,ruby:d,range:this.createRange(n,n+l.length)},length:l.length}}const i=e.match(t);if(i){const[l,c,d]=i;return{element:{type:"ruby",text:c,ruby:d,range:this.createRange(n,n+l.length)},length:l.length}}return null}parseHeading(e,n){if(!this.config.enableHeadings)return null;const s=/^(.+?)［＃「(.+?)」は(大|中|小)見出し］/,t=e.match(s);if(t){const[r,,i,l]=t,c=l==="大"?"large":l==="中"?"medium":"small",d=this.generateHeadingId(i);return{element:{type:"heading",level:c,text:i,id:d,range:this.createRange(n,n+r.length)},length:r.length}}return null}parseImage(e,n){if(!this.config.enableImages)return null;const s=/^［＃([^（]+)（([^、]+)、横(\d+)×縦(\d+)）入る］/,t=/^［＃([^（]+)（([^）]+)）入る］/,r=e.match(s);if(r){const[l,c,d,h,m]=r;return{element:{type:"image",description:c.trim(),filename:d.trim(),width:parseInt(h),height:parseInt(m),range:this.createRange(n,n+l.length)},length:l.length}}const i=e.match(t);if(i){const[l,c,d]=i;return{element:{type:"image",description:c.trim(),filename:d.trim(),range:this.createRange(n,n+l.length)},length:l.length}}return null}parseCaption(e,n){if(!this.config.enableCaptions)return null;const s=/^(.+?)［＃「(.+?)」はキャプション］/,t=e.match(s);if(t){const[r,,i]=t;return{element:{type:"caption",text:i,range:this.createRange(n,n+r.length)},length:r.length}}return null}parsePlainText(e,n){const s=/[｜［《》]/,t=e.search(s),r=t===-1?e.length:Math.max(t,1);return r===0?null:{element:{type:"text",content:e.slice(0,r),range:this.createRange(n,n+r)},length:r}}generateHeadingId(e){return e.replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").toLowerCase()+"-"+Date.now().toString(36)}createRange(e,n){return{start:{line:0,column:e,index:e},end:{line:0,column:n,index:n}}}cleanupElements(e){const n=[];for(let s=0;s<e.length;s++){const t=e[s];if(!(t.type==="text"&&t.content.trim().length===0&&t.content!=="\n")){if(t.type==="text"&&n.length>0){const r=n[n.length-1];if(r.type==="text"){r.content+=t.content,r.range.end=t.range.end;continue}}n.push(t)}}return n}createDocument(e,n,s,t,r,i,l){var c;const d=performance.now();return{title:(c=n.find(m=>m.level==="large"))==null?void 0:c.text,elements:e,headings:n,images:s,metadata:{filename:t,fileSize:i.length,encoding:(l==null?void 0:l.encoding)||"UTF-8",encodingConfidence:l==null?void 0:l.confidence,hasBom:l==null?void 0:l.hasBom,isValidEncoding:l==null?void 0:l.isValidEncoding,parseTime:d-r,elementCount:e.length,characterCount:i.length}}}}function $t(){const[a,e]=u.useState(null),[n,s]=u.useState(null),t=(l,c)=>{try{s(null);const h=new Ht().parse(l,c);e(h)}catch(d){s(d instanceof Error?d.message:"ファイルの解析に失敗しました"),e(null)}},r=l=>{s(l),e(null)},i=()=>{e(null),s(null)};return o.jsx(ze,{children:o.jsx("div",{className:"app-content",children:a?o.jsxs("div",{className:"document-view",children:[o.jsxs("div",{className:"document-header",children:[o.jsx("button",{className:"new-document-button",onClick:i,type:"button",children:"📄 新しいドキュメント"}),o.jsx("h1",{children:a.title})]}),o.jsx(Lt,{document:a})]}):o.jsxs("div",{className:"welcome-section",children:[o.jsx("h2",{children:"ファイルをドロップして開始"}),o.jsx(qe,{onFileLoad:t,onError:r,maxFileSize:50*1024*1024,acceptedFileTypes:["text/plain","text/html"]}),n&&o.jsxs("div",{className:"error-message",role:"alert",children:["❌ ",n]})]})})})}G.createRoot(document.getElementById("root")).render(o.jsx(q.StrictMode,{children:o.jsx($t,{})}));
//# sourceMappingURL=index-CAN6-LM5.js.map
